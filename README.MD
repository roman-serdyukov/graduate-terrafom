# Репозиторий для развертывания инфраструктуры с помощью Terraform в рамках дипломного проекта Нетологии по специальности "DevOps-инженер"
Состав:
-	versions.tf
Определение провайдера облачной инфраструктуры и Backend.
-	network.tf
Настройки сетевой инфраструктуры для проекта
-	dns.tf
Настройки зон DNS для проекта
-	reverse.tf
Конфигурация для VM reverse proxy. Используется версия образа ubuntu 18.04 nat instance
-	mysql.tf
Конфигурация для создания двух VM под базы данных.
- 	www.tf
Конфигурация для VM application server на wordpress
-	gitlab-ci.tf
Конфигурация для создания 2 VM под gitlab и runner
-	monitoring.tf
Конфигурация для VM monitoring с использованием prometheus/grafana/alertmanager
-	outputs.tf 
Конфигурация для вывода важных значений.
-	run.sh
Файл для автоматического запуска terraform и ролей.

## Особенности настроек
-	В концигурациях VM предусметрено копирование публичных ключей ssh.
-	Настроен на работу с Terraform cloud Backend.
- 	Созданы 2 workspaces:
a)	stage - VM  и сети создаются в зоне ru-central1-a. Используется одна общая подсеть. Для использования необходимо создать в этой зоне статический IP и указать его в зонах DNS.
б)	prod - VM и сети создаются в зоне ru-central1-a. Используются разные подсети для каждой группы серверов. На данный момент для быстрого развертывания натсроен именно этот workspace.

## Перед запуском
- Скопировать в корень проекта файл с публичным ключем ssh.
- Указать актуальное название ключа ssh в конфигурациях для VM.
- Зададть TF_TOKEN_app_terraform_io (token для Terraform cloud) в переменные среды окружения.
- Добавить в переменные YC_TOKEN в Terraform cloud.